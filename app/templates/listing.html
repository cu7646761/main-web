{% extends "base.html" %}
{% block content %}
    <!--============================= DETAIL =============================-->
    <section>
        <div class="container container-fluid">
            <div class="row">
                <div class="col-md-12 responsive-wrap">
                    <form method="POST" action="/stores/">
                    <div class="row detail-filter-wrap">
                        
                            <div class="col-md-4 featured-responsive">
                                <div class="detail-filter-text">
                                    <p>LỌC KẾT QUẢ</p>
                                </div>
                            </div>
                            <div class="col-md-3 featured-responsive">
                                <div class="detail-filter">
                                    <p>Độ phổ biến</p>
                                    <select name="level" class="custom-select">
                                        <option class="star-filter" value="">Mặc định</option>
                                        <option class="star-filter" value=SS>Trên 1000 reviews</option>
                                        <option class="star-filter" value=S>500-1000 reviews</option>
                                        <option class="star-filter" value=A selected="selected">200-500 reviews</option>
                                        <option class="star-filter" value=B>100-200 reviews</option>
                                        <option class="star-filter" value=C>50-100 reviews</option>
                                        <option class="star-filter" value=D>10-50 reviews</option>
                                        <option class="star-filter" value=E>3-10 reviews</option>
                                        <option class="star-filter" value=F>0-3 reviews</option>
                                    </select>
                                </div>
                            </div>
                            <div class="col-md-3 featured-responsive">
                                <div class="detail-filter">
                                    <p>Chất lượng</p>
                                    <select name="quality" class="custom-select">
                                        <option class="star-filter" value=0>Cao nhất</option>
                                        <option class="star-filter" value=1>Thấp nhất</option>
                                    </select>
                                </div>
                            </div>
                        
                            <div class="col-md-2 featured-responsive">
                                <div class="detail-filter">
                                    <p>Số sao</p>
                                    <select name="star" class="custom-select">
                                        <option class="star-filter">None</option>
                                        <option class="star-filter" value=5>5 sao</option>
                                        <option class="star-filter" value=4>4 sao</option>
                                        <option class="star-filter" value=3>3 sao</option>
                                        <option class="star-filter" value=2>2 sao</option>
                                        <option class="star-filter" value=1>1 sao</option>
                                    </select>
                                </div>
                            </div>
                            <div class="row">
                                <div class="row detail-checkbox-wrap col-12">
                                    {% for cate in categories%}
                                    <div class="col-sm-12 col-md-6 col-lg-4 col-xl-3">
                                        <label class="custom-control custom-checkbox">
                                            {% if selected_dics["cates"][cate.name_link] %}
                                            <input onclick="updateParamSearch()" type="checkbox" class="custom-control-input cate_id" name="cate" value="{{cate.name_link}}" checked>
                                            {% else %}
                                            <input onclick="updateParamSearch()" type="checkbox" class="custom-control-input cate_id" name="cate" value="{{cate.name_link}}">
                                            {% endif %}
                                            <span class="custom-control-indicator"></span>
                                            <span class="custom-control-descriptioBiken">{{cate.name}}</span>
                                        </label>
                                    </div>
                                    {% endfor %}
                                    
                                </div>         
                            </div>
                        <!-- SEARCH BOX-->
                            <div class="col-md-5 featured-responsive"></div>
                            <div class="col-md-7 featured-responsive">
                                <input type="submit" class="btn btn-dark" value="Tìm kiếm">
                            </div>
                        <!-- END SEARCH BOX-->
                                        
                    </div>
                    </form>
                    
                    <div class="row light-bg detail-options-wrap">
                        <nav aria-label="Page navigation example" class="col-12">
                            <ul class="pagination justify-content-end">
                                {% if pages < 3 %}
                                    {% for i in range(pages) %}
                                        <li class="page-item">
                                            <a class="page-link" href="/stores/?page={{ i+1 }}{{additional_params}}">
                                                {{i+1}}</a>
                                        </li>
                                    {% endfor %}
                                {% elif current_page == 1 %}
                                    <li class="page-item disabled">
                                        <a class="page-link" href="" tabindex="-1">Đầu</a>
                                    </li>

                                    <li class="page-item active">
                                        <a class="page-link" href="">{{ current_page }}</a>
                                    </li>
                                    <li class="page-item">
                                        <a class="page-link" href="/stores/?page={{ current_page+1 }}{{additional_params}}">
                                            {{ current_page+1}}</a>
                                    </li>
                                    <li class="page-item">
                                        <a class="page-link" href="/stores/?page={{ current_page+2 }}{{additional_params}}">
                                            {{ current_page+2}}</a>
                                    </li>
                                {% else %}
                                    <li class="page-item">
                                        <a class="page-link" href="/stores/?page=1{{additional_params}}" tabindex="-1">Đầu</a>
                                    </li>
                                    <li class="page-item">
                                        <a class="page-link" href="/stores/?page={{ current_page-1 }}{{additional_params}}"
                                           aria-label="Previous">
                                            <span aria-hidden="true">&laquo;</span>
                                            <span class="sr-only">Previous</span>
                                        </a>
                                    </li>

                                    <li class="page-item">
                                        <a class="page-link"
                                           href="/stores/?page={{ current_page-1 }}{{additional_params}}">{{ current_page-1 }}</a>
                                    </li>
                                    <li class="page-item active">
                                        <a class="page-link" href="">{{ current_page }}</a>
                                    </li>

                                {% endif %}

                                {% if current_page == pages or pages == 0 %}
                                    <li class="page-item disabled">
                                        <a class="page-link" href="" aria-label="Next">
                                            <span aria-hidden="true">&raquo;</span>
                                            <span class="sr-only">Next</span>
                                        </a>
                                    </li>

                                {% else %}
                                    {% if current_page !=1 %}
                                        <li class="page-item">
                                            <a class="page-link" href="/stores/?page={{ current_page+1 }}{{additional_params}}">
                                                {{ current_page+1}}</a>
                                        </li>
                                    {% endif %}
                                    <li class="page-item">
                                        <a class="page-link" href="/stores/?page={{ current_page+1 }}{{additional_params}}"
                                           aria-label="Next">
                                            <span aria-hidden="true">&raquo;</span>
                                            <span class="sr-only">Next</span>
                                        </a>
                                    </li>
                                {% endif %}
                            </ul>
                        </nav>


                        <div class="col-12"><p>Tìm thấy {{pages}} trang có cửa hàng 
                            
                            {% if selected_dics['level']%}
                                cấp <b style="color: red;">{{selected_dics['level']}}</b>
                            {% endif %}
                            {% if selected_dics['star']%}
                                {% if selected_dics['star'] != "None"%}
                                , có số sao trung bình từ
                                <b style="color: black;">
                                    <script>
                                        document.write("{{selected_dics['star']}}"-1);
                                    </script>
                                </b>                            
                                đến 
                                <b style="color: black;">{{selected_dics['star']}}</b> sao
                                {% endif %}
                            {% endif %}
                            {% for k,v in selected_dics["cates"].items() %}
                                {% if v %}
                                    , <i style="color: blue;">{{k}}</i>
                                {% endif %}
                            {% endfor %}
                            , Sắp xếp theo chất lượng
                            {% if selected_dics['quality'] == '1'%}
                                <b style="color: black;">Thấp nhất</b>
                            {% else %}
                                <b style="color: black;">Cao nhất</b>
                            {% endif %}
                        </p>
                        </div>
                        {% for data in datas %}
                        
                        
                        
                            
                            <div class="col-sm-12 col-lg-12 col-xl-12 featured-responsive" style="margin-bottom: 15px;">
                                <div class="featured-place-wrap">
                                    <a href="/stores/{{ data['store'].id }}">
                                        <div class="row">
                                            <div class="featured-title-box col-lg-4 col-sm-4 col-xs-12">
                                                <img style="height:200px" src="{{ data['store'].link_image[0] }}"  alt="#">
                                            </div>
                                            
                                            <span class="featured-rating-orange">{{((data['score']+1)*5)|round(2)}}</span>
                                            <div class="featured-title-box col-lg-8 col-sm-8 col-xs-12">
                                                <h6 style="padding-left:12px">{{ data['store'].name }}</h6>
                                                
                                                <p style="padding-top:30px">
                                                </p>
                                                <span> 
                                                    <i class ="fa fa-list" aria-hidden="true" style="font-size: 15px;" ></i>  
                                                    &nbsp Danh mục:
                                                {% for cate in data['cates'] %}
                                                    {{ cate.name }} 
                                                {% endfor %}
                                                </span> 
                                                <br>
                                                <p style="padding-top:30px">
                                                </p>
                                                <span> 
                                                    <i class ="fa fa-calculator" aria-hidden="true" style="font-size: 15px;" ></i> 
                                                    &nbsp Số nhận xét:  {{ data['store'].reviewer_quant }} đánh giá
                                                </span> 
                                                <br>
                                                <p style="padding-top:30px">
                                                </p>
                                                <span> 
                                                    <i class ="fa fa-star" aria-hidden="true" style="font-size: 15px;" ></i>  
                                                    &nbsp Số sao trung bình: {{ data['store'].stars }} sao
                                                </span> 

                                                <br>
                                                <p style="padding-top:30px">
                                                </p>
                                                <span> 
                                                    <i class="icon-location-pin" aria-hidden="true" style="font-size: 15px;" ></i>  
                                                    &nbsp Địa chỉ: {{ data['address'].detail }}
                                                </span> 
                                            
                                               
                                                <div class="bottom-icons">
                                                    <!-- <div class="closed-now">CLOSED NOW</div> -->
                                                    <!-- <span class="ti-heart"></span>
                                                    <span class="ti-bookmark"></span> -->
                                                </div>
                                            </div>
                                        </div>
                                        
                                    </a>
                                </div>
                            </div>
                            
                        {% endfor %}


                        <nav aria-label="Page navigation example" class="col-12">
                            <ul class="pagination justify-content-end">
                                {% if pages < 3 %}
                                    {% for i in range(pages) %}
                                        <li class="page-item">
                                            <a class="page-link" href="/stores/?page={{ i+1 }}{{additional_params}}">
                                                {{i+1}}</a>
                                        </li>
                                    {% endfor %}

                                {% elif current_page == 1 %}
                                    <li class="page-item disabled">
                                        <a class="page-link" href="" tabindex="-1">Đầu</a>
                                    </li>

                                    <li class="page-item active">
                                        <a class="page-link" href="">{{ current_page }}</a>
                                    </li>
                                    <li class="page-item">
                                        <a class="page-link" href="/stores/?page={{ current_page+1 }}{{additional_params}}">
                                            {{ current_page+1}}</a>
                                    </li>
                                    <li class="page-item">
                                        <a class="page-link" href="/stores/?page={{ current_page+2 }}{{additional_params}}">
                                            {{ current_page+2}}</a>
                                    </li>
                                {% else %}
                                    <li class="page-item">
                                        <a class="page-link" href="/stores/?page=1{{additional_params}}" tabindex="-1">Đầu</a>
                                    </li>
                                    <li class="page-item">
                                        <a class="page-link" href="/stores/?page={{ current_page-1 }}{{additional_params}}"
                                           aria-label="Previous">
                                            <span aria-hidden="true">&laquo;</span>
                                            <span class="sr-only">Previous</span>
                                        </a>
                                    </li>

                                    <li class="page-item">
                                        <a class="page-link"
                                           href="/stores/?page={{ current_page-1 }}{{additional_params}}">{{ current_page-1 }}</a>
                                    </li>
                                    <li class="page-item active">
                                        <a class="page-link" href="">{{ current_page }}</a>
                                    </li>

                                {% endif %}

                                {% if current_page == pages  or pages == 0 %}
                                    <li class="page-item disabled">
                                        <a class="page-link" href="" aria-label="Next">
                                            <span aria-hidden="true">&raquo;</span>
                                            <span class="sr-only">Next</span>
                                        </a>
                                    </li>

                                {% else %}
                                    {% if current_page !=1 %}
                                        <li class="page-item">
                                            <a class="page-link" href="/stores/?page={{ current_page+1 }}{{additional_params}}">
                                                {{ current_page+1}}</a>
                                        </li>
                                    {% endif %}
                                    <li class="page-item">
                                        <a class="page-link" href="/stores/?page={{ current_page+1 }}{{additional_params}}"
                                           aria-label="Next">
                                            <span aria-hidden="true">&raquo;</span>
                                            <span class="sr-only">Next</span>
                                        </a>
                                    </li>
                                {% endif %}
                            </ul>
                        </nav>
                    </div>


                </div>
            </div>
        </div>
        <script>
            link = "/stores/"
            function updateParamSearch(){
                var cates = document.getElementsByTagName("input");
                var cates = document.getElementsByClassName("level_filter");
                var temp ="?categories="
                for (cate of cates){
                    if (cate.checked == true){
                        temp+=cate.name+','
                    }
                }
                temp = temp.substring(0, temp.length - 1);
                console.log(temp)
                // document.getElementById("a_id").href = link + temp
            }
            function updateParamStarSearch(){
                console.log("aaa")
                var cates = document.getElementsByClassName("stars_filter");
                var temp ="?star="
                for (cate of cates){
                    if (cate.checked == true){
                        temp+=cate.value+','
                    }
                }
                temp = temp.substring(0, temp.length - 1);
                console.log(temp)
                // document.getElementById("a_id").href = link + temp
            }
            updateParamSearch()
        </script>
    </section>

    <!--//END DETAIL -->
{% include "recommend.html"%}
{% endblock %}